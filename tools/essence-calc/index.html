<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Essence Farming Calculator</title>
  <link rel="stylesheet" href="../../shared/styles.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="title-row">
      <h1>Essence Farming Calculator</h1>
      <button class="btn-icon help-btn">?</button>
    </div>
    <br>
    <div class="config-grid">
      <div>
        <label>Essences / Run</label>
        <input type="number" id="essencesPerRun" value="3" min="1">
      </div>
      <div>
        <label>Sanity / Run</label>
        <input type="number" id="sanityCost" value="80" min="1">
      </div>
    </div>

    <div class="toggle-group">
      <button class="toggle-btn active" id="modeMulti">Planner</button>
      <button class="toggle-btn" id="modeSingle">Calc</button>
    </div>

    <div class="builds-section">
      <div class="builds-header">
        <h2>Desired Essences</h2>
        <button class="btn btn-primary btn-add">+ Add Essence</button>
      </div>
      <div class="builds-list" id="buildsList"></div>
    </div>

    <div class="card" id="singleModeResults" style="display: none;">
      <h2>Energy Alluvium</h2>
      <div class="zone-list" id="zoneList"></div>
      <div class="zone-details" id="zoneDetails" style="display: none;"></div>
    </div>

    <div class="card" id="multiModeResults">
      <div class="plan-header">
        <h2>Farming Plan</h2>
        <div class="optimize-select">
          <label>Optimize for</label>
          <select id="optimizeMode" title="How to prioritize farming assignments">
            <option value="sanity" title="Balance probability and grouping for lowest total sanity">Sanity Efficiency</option>
            <option value="probability" title="Maximize per-essence drop rate, may split essences across zones">Best Probability</option>
          </select>
        </div>
      </div>
      <div id="farmingPlan"></div>
    </div>
  </div>

  <div class="modal-overlay" id="helpModal">
    <div class="modal">
      <button class="modal-close">&times;</button>
      <h2>Math</h2>
      <p><strong>Per-Essence Probability</strong></p>
      <p>Each essence rolls independently for attribute, secondary, and skill:</p>
      <p><code>P_essence = (1/attr_pool) × (1/sec_pool) × (1/skill_pool)</code></p>
      <p>If you have multiple desired essences, their probabilities add up because each roll can only match one target at a time—these are mutually exclusive outcomes.</p>

      <p><strong>Per-Run Probability</strong></p>
      <p>Each run gives you multiple essences. The chance of getting at least one match:</p>
      <p><code>P_run = 1 − (1 − P_essence)^essences_per_run</code></p>

      <p><strong>Confidence Levels</strong></p>
      <p>How many runs to reach X% confidence of getting at least one match:</p>
      <p><code>Runs = ⌈ln(1 − confidence) / ln(1 − P_run)⌉</code></p>

      <p><strong>Sanity Regen</strong></p>
      <p>1 sanity regenerates every 7 minutes and 12 seconds</p>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
