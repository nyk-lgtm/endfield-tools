<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ship Optimizer</title>
  <link rel="stylesheet" href="../../shared/styles.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="title-row">
      <h1>Ship Optimizer</h1>
      <button class="btn-icon help-btn">?</button>
    </div>
    <br>
    <!-- Room Configuration -->
    <div class="card">
      <h2>Ship Configuration</h2>
      <div id="roomConfig" class="room-config">
        <!-- Rendered by JS -->
      </div>
    </div>

    <!-- Character Selection -->
    <div class="card">
      <h2>Available Characters</h2>
      <div class="character-controls">
        <button id="selectAll" class="btn-secondary">Select All</button>
        <button id="selectNone" class="btn-secondary">Select None</button>
        <div class="global-elite-controls">
          <span class="global-elite-label">Set all to:</span>
          <button class="global-elite-btn" data-level="e1">E1</button>
          <button class="global-elite-btn" data-level="e2">E2</button>
          <button class="global-elite-btn" data-level="e3">E3</button>
          <button class="global-elite-btn active" data-level="max">E4</button>
        </div>
      </div>
      <div id="characterList" class="character-list">
        <!-- Characters rendered by JS -->
      </div>
    </div>

    <!-- Optimize Button -->
    <div class="optimize-section">
      <button id="optimizeBtn" class="btn-primary">Optimize Ship Layout</button>
      <span id="optimizeProgress" class="optimize-progress"></span>
    </div>

    <!-- Results -->
    <div class="card" id="resultsCard" style="display: none;">
      <h2>Suggested Layout</h2>
      <div id="resultsContainer">
        <!-- Results rendered by JS -->
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="helpModal">
    <div class="modal">
      <button class="modal-close">&times;</button>
      <h2>Math</h2>

      <p><strong>Efficiency Calculation</strong></p>
      <p>Base efficiency depends on operators in room:</p>
      <p><code>base = 100% + (40% × operator_count)</code></p>
      <p>Matching stat bonuses sum up and multiply the base:</p>
      <p><code>nominal = base × (1 + stat_bonus%)</code></p>

      <p><strong>Mood System</strong></p>
      <p>Operators work until mood hits 0%, then rest. Base rates:</p>
      <p><code>mood_drop = 7% per hour</code></p>
      <p><code>mood_regen = 12% per hour</code></p>
      <p>Slow Mood Drop reduces drop rate, Mood Regen (Control Nexus) increases regen for all:</p>
      <p><code>work_hours = 100 / (7 × (1 − slow_mood_drop%))</code></p>
      <p><code>rest_hours = 100 / (12 × (1 + mood_regen%))</code></p>

      <p><strong>Effective Efficiency</strong></p>
      <p>Uptime accounts for work/rest cycle:</p>
      <p><code>uptime = work_hours / (work_hours + rest_hours)</code></p>
      <p><code>effective = nominal × uptime</code></p>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
